<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1"
  />
  <title>Belles-Terres — Débat IA (maquette)</title>
  <meta name="description" content="Maquette bot-débat Belles-Terres (éoliennes/énergies)">
  <style>
    :root { color-scheme: light dark; }
    body { margin:0; font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; }
    header { padding: 12px 16px; border-bottom: 1px solid #ccc4; display:flex; align-items:center; gap:12px; }
    header h1 { font-size: 18px; margin:0; }
    main { display:grid; grid-template-columns: 1.2fr 0.8fr; gap:16px; padding:16px; }
    @media (max-width: 900px) { main { grid-template-columns: 1fr; } }
    .panel { border:1px solid #ccc4; border-radius:12px; padding:12px; background:#fff0; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    label { font-size: 14px; opacity:.9; }
    select, textarea, input[type="text"] { width:100%; padding:8px; border-radius:8px; border:1px solid #9995; background:#fff0; color:inherit; }
    textarea { min-height: 180px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; }
    .chat { height: 52vh; min-height: 320px; overflow:auto; display:flex; flex-direction:column; gap:8px; padding:8px; border:1px solid #ccc4; border-radius:12px; background: #0000; }
    .msg { padding:10px 12px; border-radius:10px; white-space:pre-wrap; line-height:1.35; }
    .msg.user { align-self:flex-end; background:#0b5bf533; border:1px solid #0b5bf555; }
    .msg.bot  { align-self:flex-start; background:#14a14a33; border:1px solid #14a14a55; }
    .controls { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .controls > * { flex: none; }
    button { padding:10px 12px; border-radius:10px; border:1px solid #6665; background:#fff0; cursor:pointer; }
    button:hover { background:#6661; }
    .muted { opacity:.7; font-size:12px; }
    select, option { background-color: Canvas; color: CanvasText; }
  </style>
</head>
<body>
  <header>
    <h1>⚡ Belles-Terres — bot de relance (maquette)</h1>
    <span class="muted">Démo plénum/groupes — personas & monde éditables</span>
  </header>

  <main>
    <!-- Colonne gauche : Chat -->
    <section class="panel">
      <div class="row" style="gap:12px; margin-bottom:8px;">
        <label>Persona:
          <select id="persona"></select>
        </label>
        <label>Modèle:
          <select id="model">
            <option value="gpt-4o-mini">gpt-4o-mini (reco)</option>
            <option value="gpt-4o-mini-translate">gpt-4o-mini-translate</option>
          </select>
        </label>
        <label class="row" style="gap:6px;">
          <input type="checkbox" id="tts" />
          <span>Voix (lire les réponses)</span>
        </label>
      </div>

      <div id="chat" class="chat" aria-live="polite"></div>

      <div class="row" style="margin-top:8px; align-items:flex-start;">
        <textarea id="input" placeholder="Propose ton idée, pose une question… (Entrée pour envoyer)"></textarea>
      </div>
      <div class="controls" style="margin-top:8px;">
        <button id="send">Envoyer</button>
        <button id="save">Sauvegarder la session</button>
        <button id="reset">Nouvelle conversation</button>
        <span class="muted">Les logs NDJSON sont enregistrés côté R2 lors du clic “Sauvegarder”.</span>
      </div>
    </section>

    <!-- Colonne droite : Monde & aide -->
    <aside class="panel">
      <h3 style="margin-top:0">Monde (éditable pour test)</h3>
      <textarea id="world" spellcheck="false"></textarea>
      <p class="muted">
        Personas : <code>./data/personas.json</code> — Monde : <code>./data/world.json</code>.
        Les règles d’immersion sont dans <code>./assets/prompt.js</code>.
      </p>
      <details>
        <summary>Conseils</summary>
        <ul>
          <li>Changer de persona réinitialise la conversation (immersion).</li>
          <li>“Voix” utilise la synthèse intégrée du navigateur. Voir plus bas pour des voix dédiées.</li>
        </ul>
      </details>
    </aside>
  </main>

  <!-- Scripts (ES modules) -->
  <script type="module" src="./assets/app.js?v=3"></script>
  <div id="boot" style="position:fixed;inset:0;display:none;place-items:center;background:color-mix(in srgb, Canvas, CanvasText 5%);z-index:9999">
  <div style="width:min(480px,90vw);padding:16px;border:1px solid #ccc4;border-radius:12px;background:Canvas;color:CanvasText;box-shadow:0 10px 30px #0003;">
    <div id="boot-msg" style="margin-bottom:10px">Préparation…</div>
    <div id="boot-bar" style="height:8px;background:#0001;border-radius:8px;overflow:hidden">
      <div style="height:100%;width:var(--p,0%);background:#0b5bf5"></div>
    </div>
  </div>
</div>

</body>
</html>
